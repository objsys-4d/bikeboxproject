var AJAX=ajaxGetRequestObject(),CONN={form:"",action:"",record:"",tab:"",destroy:"",messages:[],method:"",data:[],selected:[]};function ltgQCHide(){ltgObj("ltg-qc").css("display","none")}function ltgQCPopover(){ltgObj("ltg-qc-popover").popover("show")}function ltgQC(e,t){ltgObj("ltg-qc-popover").popover("hide"),ltgObj("ltg-qc-popover").removeClass("btn-outline-success"),ltgObj("ltg-qc-popover").removeClass("btn-outline-danger"),ltgObj("ltg-performance").html('<i class="fa fa-tachometer-alt"></i> '+e),ltgObj("ltg-qc-popover").popover("dispose");for(var n="",l=0;l<CONN.messages.length;l++){var a=CONN.messages[l].description,o=CONN.messages[l].value,s=CONN.messages[l].form,r=CONN.messages[l].line;n+="error"==CONN.messages[l].type?'<p class="small mb-0">'+a+'&nbsp;<code class="text-danger">'+o+"</code>":'<p class="small mb-0">'+a+'&nbsp;<code class="text-success">'+o+"</code>",0<r?n+='&nbsp;<span class="text-secondary">('+s+":"+r+")</span>":""==!s&&(n+='&nbsp;<span class="text-secondary">('+s+")</span>"),n+="</p>",l<CONN.messages.length-1&&(n+='<div class="dropdown-divider"></div>')}ltgObj("ltg-qc-popover").popover({content:n,html:!0}),0<t?(ltgObj("ltg-qc-popover").addClass("btn-outline-danger"),ltgObj("ltg-errors").html('&nbsp;&nbsp;<i class="fa fa-bug"></i> '+t)):(ltgObj("ltg-qc-popover").addClass("btn-outline-success"),ltgObj("ltg-errors").html(""))}function ltgSet(e,t){"selected"==e&&(t=JSON.parse(t)),"data"==e&&(t=JSON.parse(t)),"messages"==e&&(t=JSON.parse(t)),CONN[e]=t}function ltgFileUpload(e,t){var n=new FormData,l=document.getElementById(e).files[0];n.append("action","file"),n.append("method",t),n.append("files[]",l),AJAX.open("POST","/LTGAJAX",!0),AJAX.send(n)}function ltgFormAction(e){if(e){for(var t="",n="",l=!1,a="",o=e.slice(e.indexOf("?")+1).split("&"),s=0,r=o.length;s<r;s+=1)switch(hash=o[s].split("="),hash[0]){case"action":t=hash[1];break;case"method":n=hash[1];break;case"modal":l="true"==hash[1];break;case"record":a=hash[1]}var c="";switch(""==(c=(c=(c=-1<e.indexOf("//")?e.split("/")[2]:e.split("/")[0]).split(":")[0]).split("?")[0])&&(c=CONN.form),t){case"select":var i=jsonFindValue(CONN.selected,{form:c,record:a});-1==i?CONN.selected.push({form:c,record:a}):CONN.selected.splice(i);break;default:ltgCallback(t,a,n,c,l)}}else ltgMessage("error","ltgFormAction - parameters is null.")}function jsonFindValue(e,t){for(var n=-1,l=0;l<e.length;l++)if(JSON.stringify(e[l])==JSON.stringify(t)){n=l;break}return n}function ltgEval(script){try{eval(script)}catch(e){e instanceof SyntaxError&&alert(e.message+"\n\n"+script)}}function ltgObj(e){return $("#"+e.replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&"))}function ltgObjFocus(e){var t,n=document.getElementById(e);n&&(t=2*(n=ltgObj(e)).val().length,n.focus(),n.setSelectionRange&&n[0].setSelectionRange(t,t))}function ltgObjSynch(e,t){$('input[id="'+e+'"]').val(t)}function ltgAccordionPanelClose(e){ltgObj(e).collapse("hide")}function ltgAccordionPanelSetActive(e){ltgObj(e).collapse("show")}function ltgAccordionPanelSetIcon(e,t){var n=ltgObj(e).find("i");n.removeClass(),n.addClass(t)}function ltgAccordionPanelSetTitle(e,t){ltgObj(e).find("span").text(t)}function ltgTabSetActive(e){ltgObj(e).tab("show"),CONN.tab=e}function ltgTabSetIcon(e,t){var n=ltgObj(e).find("i");n.removeClass(),n.addClass(t)}function ltgTabSetTitle(e,t){ltgObj(e).find("span").text(t)}function ltgFormPublish(e,t){var n,l,a,o=e.split("\n")[0];if(o=(o=(o=o.replace("\x3c!--","")).replace("--\x3e","")).trim(),t&&(a=document.getElementById("ltg-modals"),document.getElementById(o)||(a.innerHTML+='<div id="'+o+'"></div>')),(n=document.getElementById(o))||(o="ltg-content",n=document.getElementById(o)),n){n.innerHTML=e,l=n.getElementsByTagName("script");for(var s=0;s<l.length;s++)ltgEval(l[s].text);t&&ltgDialogOpen(o)}else alert("Form not found: "+o)}function ltgLogout(e){e=e||"logout",document.lightning.action=e,document.lightning.submit()}function ltgDialogOpen(e){ltgObj(e).modal({backdrop:"static",keyboard:!1},"show")}function ltgDialogClose(e){ltgObj(e).modal("hide"),ltgObj(e).css("display","none"),CONN.destroy="true"}function ltgMessage(e,t){alert(e+": "+t)}function ltgExecuteMethod(e,t){t&&(e+="/"+t),ltgCallback("method",CONN.record,e)}function ltgSearchSubmit(e){var t=!1;return e&&13!=(window.event?window.event.keyCode:e.which)||(t=!0),!0!==t||(ltgCallback("search","","",CONN.form),!1)}function ltgSelectAddOption(e,t,n){var l,a,o=document.getElementById(e);o&&(!(l=document.createElement("option"))||(a=document.createTextNode(n))&&(l.appendChild(a),l.setAttribute("value",t),o.appendChild(l)))}function ltgSelectDeleteOptions(e){var t=document.getElementById(e);t&&(t.length=0)}function ltgSelectGetValue(e){var t=document.getElementById(e),n=null;return t&&(n=t.options[t.selectedIndex].value),n}function ltgSelectSetValue(e,t){ltgObj(e).val(t)}function ltgSelectGetOptionCount(e){var t=e.childNodes.length,n=0;for(i=0;i<t;i++)1==e.childNodes.item(i).nodeType&&n++;return n}function ltgSelectMultipleGetValues(e,t){var n=ltgSelectGetOptionCount(e),l=document.getElementById(t);l.value="";for(var a=0;a<n;a++)e.options[a].selected&&(l.value+=e.options[a].value+",");return l.value=l.value.substring(0,l.value.length-1),!0}function ltgSelectMultipleGetAllValues(e,t){var n=ltgSelectGetOptionCount(e),l=document.getElementById(t);l.value="";for(var a=0;a<n;a++)l.value+=e.options[a].value+",";return l.value=l.value.substring(0,l.value.length-1),!0}function arrayFindValue(e,t){for(var n=-1,l=0;l<e.length;l++)if(e[l]==t){n=l;break}return n}function arrayDeleteValue(e,t){var n=arrayFindValue(e,t);return-1!=n&&e.splice(n,1),e}function arrayToString(e,t){for(var n="",l=0;l<e.length;l++)""!=e[l]&&(n+=t+e[l]);return n}function buttonsAddMandatoryLegend(e,t){var n=document.getElementById(e);n&&(n.innerHTML+='&#160;&#160;<table align="right"><tr valign="middle"><td style="padding-top:5px;padding-right:4px;"><span class="ui-state-hover">&#160;</span>&#160;= '+t+"</td></tr></table>")}function dateFormat(e){var t=new Date,n=t.getMonth()+1,l=t.getDate(),a=t.getFullYear(),o="";switch(l<10&&(l="0"+l),n<10&&(n="0"+n),e){case"mm/dd/yyyy":o=n+"/"+l+"/"+a;break;case"dd/mm/yyyy":o=l+"/"+n+"/"+a}return o}function getObject(e,t){var n,l,a;for(t=t||document,null!=e&&0<(n=e.indexOf("?"))&&parent.frames.length&&(t=parent.frames[e.substring(n+1)].document,e=e.substring(0,n)),!(a=t[e])&&t.all&&(a=t.all[e]),l=0;!a&&l<t.forms.length;l++)a=t.forms[l][e];for(l=0;!a&&t.layers&&l<t.layers.length;l++)a=getObject(e,t.layers[l].document);return!a&&t.getElementById&&(a=t.getElementById(e)),a}function ajaxGetRequestObject(){var t;if(!t&&"undefined"!=typeof XMLHttpRequest)try{t=new XMLHttpRequest}catch(e){t=!1}if(!t&&window.createRequest)try{t=window.createRequest()}catch(e){t=!1}if(!t&&"undefined"!=typeof ActiveXObject){try{t=new ActiveXObject("MSXML2.XMLHTTP")}catch(e){t=!1}if(!t)try{t=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){t=!1}}return t}function ltgCallback(e,t,n,c,i){var l=document.forms.lightning,a=l.elements.length;CONN.messages=[],CONN.data=[],e&&(CONN.action=e),t&&(CONN.record=t),CONN.method=n,c&&(c=encodeURIComponent(c),CONN.form=c);for(var o=0;o<a;o++)""==!l.elements[o].name&&("radio"!=l.elements[o].type||l.elements[o].checked)&&CONN.data.push({name:l.elements[o].name,value:encodeURIComponent(l.elements[o].value)});AJAX.open("POST","/LTGAJAX",!0),AJAX.setRequestHeader("Content-Type","application/json"),AJAX.onreadystatechange=function(){if(4==AJAX.readyState){var e,t,n,l,a,o,s=AJAX.getResponseHeader("VND.Lightning.Payload"),r=AJAX.responseText;switch(r){case"":break;case"5300":case"5301":ltgLogout();break;case"5600":ltgMessage("error","5600 - Form not found");break;default:"true"==CONN.destroy&&((e=document.getElementById(c))&&(e.innerHTML=""),CONN.destroy="false"),"file"==CONN.action?(t=AJAX.getResponseHeader("content-disposition"),l=null!=(n=/"([^"]*)"/.exec(t))&&n[1]?n[1]:"filename.txt",a=new Blob([r]),(o=document.createElement("a")).href=window.URL.createObjectURL(a),o.download=l,o.click()):"html"==s?ltgFormPublish(r,i):"javascript"==s&&ltgEval(r)}}};var s=JSON.stringify(CONN);AJAX.send(s)}